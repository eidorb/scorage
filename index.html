<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Scorage</title>
  <link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"  media="screen,projection"/>
  <link type="text/css" rel="stylesheet" href="scorage.css"/>
</head>

<body>

  <nav>
    <div class="nav-wrapper container">
      <a class="brand-logo center" href="javascript:;">Scorage</a>
    </div>
  </nav>

  <div id="ractive-container"></div>

  <script id="template" type="text/ractive">

    <ul class="tabs">
      <li class="tab"><a href="javascript:;" class="{{ (view === 'score') ? 'active' : '' }}" on-click="set('view', 'score')">Scores</a></li>
      <li class="tab"><a href="javascript:;" class="{{ (view === 'setup') ? 'active' : '' }}" on-click="set('view', 'setup')">Setup</a></li>
    </ul>

    <div class="container">
      {{ #(view === 'score') }}
      <div class="row">
        <div class="col s12">
          <table class="centered">
            <thead>
              <tr>
                <th colspan="2">Round</th>

                {{ #each shortenedNames }}
                <th><div class="chip">{{ this }}</div></th>
                {{ /each }}

                <th>&Sigma;</th>
              </tr>
            </thead>

            {{ #createTable() }}
            <tbody>
              {{ #each rounds: round }}
              <tr>
                <th rowspan="3">{{ round + 1 }}</th>
                <th>Bids</th>

                {{ #each bids: index }}
                <td><input type="number" value="{{ this === null ? '' : this }}" on-input="editBid: {{ round }}, {{ index }}" twoway="false" class="browser-default number-input"></td>
                {{ /each }}

                <td>{{ totalBids }}</td>

                {{ #if(round && (round == numRounds - 1)) }}
                <td rowspan="3"><a class="waves-effect waves-light btn red" on-click="removeRound: {{ round }}"><i class="material-icons left">remove_circle</i>Remove Round</a></td>
                {{ /if }}
              </tr>

              <tr>
                <th>Tricks</th>

                {{ #each tricks: index }}
                <td><input type="number" value="{{ this === null ? '' : this }}" on-input="editTrick: {{ round }}, {{ index }}" twoway="false" class="number-input"></td>
                {{ /each }}

                <td>{{ totalTricks }}</td>
              </tr>

              <tr>
                <th>Points</th>

                {{ #each points: index }}
                <td>
                  {{ # !(this === null) }}
                  <span class="{{ (this > 0) ? 'green-text text-darken-1' : (this < 0) ? 'red-text text-darken-1' : ''}}"><strong>{{ (this > 0) ? '+' + this : this }}</strong></span>
                  {{ / }}
                </td>
                {{ /each }}
              </tr>
              {{ /each }}

              <tr>
                <th colspan="2">Scores</th>

                {{ #each scores }}
                <td>{{ this }}</td>
                {{ /each }}
              </tr>
            </tbody>
            {{ /createTable }}
          </table>
        </div>
      </div>

      <div class="row">
        <div class="col s12">
          <div class="input-field">
            <a class="waves-effect waves-light btn green" on-click="addRound"><i class="material-icons left">add_circle</i>Add Round</a>
            <a class="waves-effect waves-light btn red" on-click="removeAllRounds"><i class="material-icons left">delete_forever</i>Remove All Rounds</a>
          </div>
        </div>
      </div>
      {{ /(view === 'score') }}


      {{ #(view === 'setup') }}
      <div class="row">
        <div class="col s12 m6">
          <h4>Player names</h4>

          {{ #each players: index }}
          <div class="input-field">
            <input type="text" placeholder="Player name" value="{{ name }}" on-input="editPlayerName: {{ index }}" twoway="false">

            {{ #if players.length > 1 }}
            <a class="waves-effect waves-light btn red" on-click="removePlayer: {{ index }}"><i class="material-icons">remove_circle</i></a>
            {{ /if }}
          </div>
          {{ /each}}

          <div class="input-field">
            <input id="new-player-name" type="text" on-change="addPlayer">
            <label for="new-player-name">New player name</label>
          </div>
        </div>

        <div class="col s12 m6">
          <h4>Rules</h4>

          <div class="input-field">
            <select class="browser-default" value="{{ rules }}">
              {{ #each ruleSets: id }}
              <option value="{{ id }}">{{ name }}</option>
              {{ /each }}
            </select>
          </div>

          <ul class="browser-default">
            {{ #each ruleSets[rules].details }}
            <li>{{ this }}</li>
            {{ /each }}
          </ul>
        </div>
      </div>
      {{ /(view === 'setup') }}
    </div>
  </script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/ractive/0.7.3/ractive.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/store.js/1.3.20/store.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
  <script src="scorage.js"></script>
</body>
</html>
